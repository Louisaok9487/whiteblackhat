<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Gray-Fox</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap');

        :root {
            --background-color: #0d0d0d;
            --text-color: #00ff41;
            --prompt-color: #00ff41;
            --input-color: #ffffff;
            --highlight-color: #faffa8;
            --error-color: #ff4d4d;
            --whitehat-color: #75aaff;
            --blackhat-color: #ff4d4d;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Inconsolata', monospace;
            font-size: 16px;
            line-height: 1.5;
            margin: 0;
            padding: 1rem;
            overflow-x: hidden;
        }
        
        #status-bar {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            border: 1px solid var(--text-color);
            z-index: 100;
            font-size: 14px;
        }

        #status-bar span {
            margin-left: 1rem;
        }

        #terminal {
            height: 100vh;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        #output {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px; /* For scrollbar */
        }

        .input-line {
            display: flex;
            align-items: center;
        }

        .prompt {
            color: var(--prompt-color);
            margin-right: 0.5rem;
            white-space: nowrap;
        }

        #input {
            background-color: transparent;
            border: none;
            color: var(--input-color);
            font-family: inherit;
            font-size: inherit;
            width: 100%;
            outline: none;
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background-color: var(--input-color);
            animation: blink 1s step-end infinite;
            vertical-align: bottom;
        }

        @keyframes blink {
            50% {
                background-color: transparent;
            }
        }

        .error { color: var(--error-color); }
        .white-hat { color: var(--whitehat-color); }
        .black-hat { color: var(--blackhat-color); }

        .highlight {
            background-color: var(--text-color);
            color: var(--background-color);
            padding: 0 4px;
        }
    </style>
</head>
<body>

<div id="status-bar">
    <span>💰 Money: $<span id="money">0</span></span>
    <span>😇 White Hat: <span id="white-hat-rep">0</span></span>
    <span>😈 Black Hat: <span id="black-hat-rep">0</span></span>
</div>

<div id="terminal">
    <div id="output"></div>
    <div class="input-line">
        <span class="prompt" id="prompt">gray-fox@local:~$</span>
        <input type="text" id="input" autofocus>
        <span class="cursor"></span>
    </div>
</div>

<script>
    // --- DOM Elements ---
    const terminal = document.getElementById('terminal');
    const output = document.getElementById('output');
    const input = document.getElementById('input');
    const promptEl = document.getElementById('prompt');
    const moneyEl = document.getElementById('money');
    const whiteHatRepEl = document.getElementById('white-hat-rep');
    const blackHatRepEl = document.getElementById('black-hat-rep');

    // --- Game State ---
    let commandHistory = [];
    let historyIndex = -1;
    let gameState = {
        money: 0,
        whiteHatRep: 0,
        blackHatRep: 0,
        currentMission: null,
        inMinigame: false,
        minigameCallback: null,
        // --- Mission Database ---
        missions: {
            "mission_01": {
                id: "mission_01",
                type: "sql_injection",
                title: "Vulnerability Assessment for OmniCorp",
                client: "OmniCorp",
                targetIp: "192.168.1.101",
                completed: false,
                mail: `
From: contact@omnicorp.sec
To: gray-fox
Subject: Urgent: Security Assessment Required

We require your services for a penetration test on one of our web servers. We suspect a potential vulnerability in our login system.
Target IP: <span class="highlight">192.168.1.101</span>
Your task is to assess the system and report any findings.
`,
            },
            "mission_02": {
                id: "mission_02",
                type: "social_engineering",
                title: "Employee Security Awareness Test",
                client: "CyberRight Inc.",
                target: "TechSolutions LLC",
                completed: false,
                mail: `
From: security@cyberright.inc
To: gray-fox
Subject: Contract: Social Engineering Test

Gray-Fox, we need you to test the human element at TechSolutions LLC.
Your task is to acquire an admin password via phone (vishing).
Target: TechSolutions Help Desk.
Use command <span class="highlight">social_eng TSL_HelpDesk</span> to initiate the call.
`
            },
            "mission_03": {
                id: "mission_03",
                type: "data_theft",
                title: "Acquire Competitor's Project Files",
                client: "Anonymous",
                targetIp: "203.0.113.78",
                completed: false,
                mail: `
From: [REDACTED]
To: gray-fox
Subject: A Lucrative Opportunity

We need access to the prototype files on Innovatech's internal server.
Their security is weak. Get in, get the files, get out.
IP: <span class="highlight">203.0.113.78</span>
Discretion is key. Payment will be substantial.
`
            },
            "mission_04": {
                id: "mission_04",
                type: "wifi_cracking",
                title: "Coffee Shop WiFi Test",
                client: "The Daily Grind Cafe",
                target: "GrindNet_Guest",
                completed: false,
                mail: `
From: owner@dailygrind.cafe
To: gray-fox
Subject: Security check on our Guest WiFi

Hi, we'd like to hire you to check if our guest WiFi is secure.
The network name is <span class="highlight">GrindNet_Guest</span>.
Please see if you can get the password and let us know.
Use <span class="highlight">scan_wifi</span> to begin.
`
            },
            "mission_05": {
                id: "mission_05",
                type: "phishing",
                title: "Corporate Phishing Drill",
                client: "Securitas Corp",
                target: "MegaCorp Inc.",
                completed: false,
                mail: `
From: audit@securitas.corp
To: gray-fox
Subject: Phishing Susceptibility Audit

We need you to conduct a phishing drill on employees at MegaCorp Inc.
Your goal is to see how many credentials you can capture.
Use <span class="highlight">craft_phish</span> to design the attack email.
`
            },
            "mission_06": {
                id: "mission_06",
                type: "physical_hacking",
                title: "USB Drop",
                client: "Anonymous Client",
                target: "Rival Corp HQ",
                completed: false,
                mail: `
From: [ENCRYPTED]
To: gray-fox
Subject: Physical Infiltration

We need you to plant a 'special' USB drive somewhere inside Rival Corp's main office.
Someone is bound to pick it up. The drive will do the rest.
Use <span class="highlight">infiltrate Rival_Corp_HQ</span> to begin the operation.
`
            },
            "mission_07": {
                id: "mission_07",
                type: "network_sniffing",
                title: "Internal Data Leak Investigation",
                client: "Fintech Solutions",
                targetIp: "10.10.5.15",
                completed: false,
                mail: `
From: cso@fintech.sol
To: gray-fox
Subject: Suspected Insider Threat

We believe an employee is exfiltrating sensitive client data.
We need you to monitor traffic from their workstation at <span class="highlight">10.10.5.15</span> and find proof.
Use <span class="highlight">sniff_traffic 10.10.5.15</span> to start monitoring.
`
            },
            "mission_08": {
                id: "mission_08",
                type: "ai_adversarial",
                title: "Test AI Security System",
                client: "Cerebrum AI",
                target: "Cerebrum GuardAI",
                completed: false,
                mail: `
From: labs@cerebrum.ai
To: gray-fox
Subject: Adversarial Attack Challenge

We've built the world's most advanced AI-powered facial recognition security. We challenge you to fool it.
Your task is to get past our system by making it misclassify you.
Use <span class="highlight">access_ai_lab</span> to begin the test.
`
            },
            "mission_09": {
                id: "mission_09",
                type: "ransomware",
                title: "Ransomware Deployment",
                client: "DarkNet Syndicate",
                targetIp: "172.16.30.120",
                completed: false,
                mail: `
From: syndicate-boss@darknet.onion
To: gray-fox
Subject: Job Offer: High Reward

A local clinic has weak security. A perfect target.
Deploy our ransomware on their server at <span class="highlight">172.16.30.120</span>.
The payout will be huge. Use <span class="highlight">scan [ip]</span> to find an entry point.
`
            },
             "mission_10": {
                id: "mission_10",
                type: "dos_attack",
                title: "Tournament Disruption",
                client: "Salty Gamers Crew",
                targetIp: "198.51.100.45",
                completed: false,
                mail: `
From: l33th4x@saltygamers.net
To: gray-fox
Subject: Take 'em down!

The 'Pro Gamers United' team needs to be taken offline during the championship match tonight.
Their game server is at <span class="highlight">198.51.100.45</span>.
We'll pay you well to flood their server.
Use <span class="highlight">initiate_botnet</span> to get started.
`
            },
            "mission_11": {
                id: "mission_11",
                type: "password_cracking",
                title: "Crack the Database",
                client: "Data Brokers Inc.",
                target: "leaked_db.hash",
                completed: false,
                mail: `
From: acquisitions@databrokers.inc
To: gray-fox
Subject: Hashed Password File

We've acquired a user database from the recent 'SocialSphere' breach.
The passwords are all hashed. We need you to crack them.
The file is named <span class="highlight">leaked_db.hash</span>.
Use <span class="highlight">crack_hashes leaked_db.hash</span> to begin.
`
            },
            "mission_12": {
                id: "mission_12",
                type: "mobile_hacking",
                title: "Targeted Surveillance",
                client: "Gov Agency [CLASSIFIED]",
                target: "Journalist",
                completed: false,
                mail: `
From: agent.k@gov.sec
To: gray-fox
Subject: National Security Matter

We require your expertise to monitor a person of interest.
You are to develop a trojan application and convince the target, a journalist, to install it on their phone.
Use <span class="highlight">develop_app</span> to start.
`
            },
            "mission_13": {
                id: "mission_13",
                type: "cloud_hacking",
                title: "Cloud Storage Audit",
                client: "StartUp Innovations",
                target: "startup-innovations.com",
                completed: false,
                mail: `
From: ceo@startup-innovations.com
To: gray-fox
Subject: Urgent Cloud Security Audit

We're worried we might have misconfigured our cloud storage and exposed customer data.
Please audit our storage buckets, linked to our domain <span class="highlight">startup-innovations.com</span>.
Use <span class="highlight">scan_cloud startup-innovations.com</span> to check for open buckets.
`
            }
        }
    };

    // --- Core Game Logic ---
    input.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            const command = input.value.trim();
            if (command) {
                printToOutput(`<span class="prompt">${promptEl.textContent}</span> ${command}`);
                handleCommand(command);
                commandHistory.unshift(command);
                historyIndex = -1;
                input.value = '';
                scrollToBottom();
            }
        } else if (e.key === 'ArrowUp') {
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                input.value = commandHistory[historyIndex];
            }
        } else if (e.key === 'ArrowDown') {
            if (historyIndex > 0) {
                historyIndex--;
                input.value = commandHistory[historyIndex];
            } else {
                historyIndex = -1;
                input.value = '';
            }
        }
    });

    terminal.addEventListener('click', () => { input.focus(); });

    function handleCommand(command) {
        const [cmd, ...args] = command.toLowerCase().split(' ');

        if (cmd === 'help') { showHelp(); return; }
        if (cmd === 'clear') { output.innerHTML = ''; return; }
        
        if (gameState.inMinigame) {
            if (gameState.minigameCallback) gameState.minigameCallback(command);
            return;
        }

        switch (cmd) {
            case 'whoami': printToOutput('User: gray-fox 🧑‍💻'); break;
            case 'mail': checkMail(); break;
            case 'scan': runScan(args[0]); break;
            case 'exploit': runExploit(args[0], args[1]); break;
            case 'report': runReport(); break;
            case 'exploit_data': runExploitData(); break;
            
            // New Commands
            case 'social_eng': startSocialEngineeringMinigame(args[0]); break;
            case 'scan_wifi': startWifiScan(); break;
            case 'crack_wpa2': startWifiCrack(args[0]); break;
            case 'craft_phish': startPhishingMinigame(); break;
            case 'infiltrate': startPhysicalHackingMinigame(args[0]); break;
            case 'sniff_traffic': startNetworkSniffing(args[0]); break;
            case 'access_ai_lab': startAiMinigame(); break;
            case 'initiate_botnet': startDosMinigame(); break;
            case 'crack_hashes': startPasswordCrack(args[0]); break;
            case 'develop_app': startMobileHacking(); break;
            case 'scan_cloud': startCloudScan(args[0]); break;

            default: printToOutput(`<span class="error">Command not found: ${cmd}. Type 'help' for a list of commands.</span>`);
        }
    }

    // --- Command Functions ---
    function showHelp() {
        const helpText = `
Project Gray-Fox Help:
  <span class="highlight">help</span>                 - Shows this help message.
  <span class="highlight">clear</span>                - Clears the terminal screen.
  <span class="highlight">whoami</span>               - Displays your current user.
  <span class="highlight">mail</span>                 - Checks for new messages and missions.
  <span class="highlight">scan [ip]</span>              - Scans a target IP for vulnerabilities.
  <span class="highlight">exploit [vuln]</span>         - Attempts to exploit a found vulnerability.
  <span class="highlight">report</span>                 - Report vulnerability to client (White Hat).
  <span class="highlight">exploit_data</span>           - Steal data for profit (Black Hat).

Mission Specific Commands:
  <span class="highlight">social_eng [target]</span>    - Initiates a social engineering attack.
  <span class="highlight">scan_wifi</span>              - Scans for nearby WiFi networks.
  <span class="highlight">crack_wpa2 [bssid]</span>   - Attempts to crack a WPA2 password.
  <span class="highlight">craft_phish</span>            - Designs a phishing email.
  <span class="highlight">infiltrate [location]</span>  - Attempts a physical intrusion.
  <span class="highlight">sniff_traffic [ip]</span>     - Monitors network traffic from a target.
  <span class="highlight">access_ai_lab</span>          - Begins an adversarial attack on an AI.
  <span class="highlight">initiate_botnet</span>        - Prepares a botnet for a DoS attack.
  <span class="highlight">crack_hashes [file]</span>    - Tries to crack passwords from a hash file.
  <span class="highlight">develop_app</span>            - Starts development of a malicious app.
  <span class="highlight">scan_cloud [domain]</span>    - Scans for misconfigured cloud storage.
        `;
        printToOutput(helpText.replace(/\n/g, '<br>'));
    }
    
    function checkMail() {
        if (gameState.currentMission) {
            printToOutput("You already have an active mission. Complete it first.");
            return;
        }

        const availableMissions = Object.values(gameState.missions).filter(m => !m.completed);
        if (availableMissions.length === 0) {
            printToOutput("No new messages. You have completed all available missions!");
            return;
        }

        const mission = availableMissions[Math.floor(Math.random() * availableMissions.length)];
        gameState.currentMission = mission.id;
        
        const mailText = `New Message (1):${mission.mail}`;
        typewriterEffect(mailText);
    }

    function runScan(targetIp) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission) {
            printToOutput(`<span class="error">Error: No active mission. Check your mail.</span>`);
            return;
        }
        if (targetIp !== mission.targetIp) {
            printToOutput(`<span class="error">Error: Invalid target IP for current mission.</span>`);
            return;
        }

        let scanText = `Scanning ${targetIp}...`;
        if (mission.type === 'sql_injection') {
            scanText += `
[!] Potential SQL Injection vulnerability detected on login form!
To proceed, use the command: <span class="highlight">exploit sql_injection</span>`;
        } else if (mission.type === 'data_theft') {
            scanText += `
[!] Found an unpatched FTP server on port 21.
Default credentials might work.
To proceed, use the command: <span class="highlight">exploit default_creds</span>`;
        } else if (mission.type === 'ransomware') {
             scanText += `
[!] Found an unpatched SMBv1 vulnerability (EternalBlue).
This could allow for remote code execution.
To proceed, use the command: <span class="highlight">exploit eternalblue</span>`;
        } else {
             scanText += `\nNo obvious vulnerabilities found.`;
        }
        typewriterEffect(scanText);
    }
    
    function runExploit(vulnerability, arg2) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission) { printToOutput(`<span class="error">Error: No active mission.</span>`); return; }

        vulnerability = vulnerability ? vulnerability.toLowerCase() : '';

        if (mission.type === 'sql_injection' && vulnerability === 'sql_injection') {
            startSqlInjectionMinigame();
        } else if (mission.type === 'data_theft' && vulnerability === 'default_creds') {
            typewriterEffect(`
Attempting login with common default credentials (admin:admin, root:password)...
<span class="highlight">Access Granted!</span> You are in their file system.
Now, what's your next move?
  - <span class="highlight">report</span>: Inform Innovatech of their weak security. (White Hat)
  - <span class="highlight">exploit_data</span>: Download the 'Project_Chimera_blueprints.zip'. (Black Hat)
            `);
        } else if (mission.type === 'ransomware' && vulnerability === 'eternalblue') {
             typewriterEffect(`
Exploiting SMBv1 vulnerability... Success!
You have root access to the clinic's server.
Now, what's your next move?
  - <span class="highlight">report</span>: Anonymously report the critical vulnerability to the clinic. (White Hat)
  - <span class="highlight">exploit_data</span>: Deploy the ransomware as instructed. (Black Hat)
            `);
        } else {
            printToOutput(`<span class="error">Exploit failed or invalid vulnerability for this mission.</span>`);
        }
    }
    
    function completeMission(money, whiteHat, blackHat) {
        gameState.money += money;
        gameState.whiteHatRep += whiteHat;
        gameState.blackHatRep += blackHat;
        updateStatus();
        
        if(gameState.currentMission) {
            gameState.missions[gameState.currentMission].completed = true;
            gameState.currentMission = null;
        }
        
        printToOutput("<br>Mission Completed! Check 'mail' for new assignments.");
    }

    function runReport() {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission) { printToOutput(`<span class="error">Error: No active mission to report.</span>`); return; }
        
        let reward = 5000;
        if (mission.type === 'ransomware') reward = 1000; // Lower reward for just a report
        if (mission.type === 'cloud_hacking') reward = 8000;

        const reportText = `
Generating report for ${mission.client}...
Report sent successfully.

<span class="highlight">Payment received: $${reward.toLocaleString()}</span>
<span class="white-hat">Reputation changed: White Hat +1 😇</span>
        `;
        typewriterEffect(reportText, () => completeMission(reward, 1, 0));
    }

    function runExploitData() {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission) { printToOutput(`<span class="error">Error: No data to exploit.</span>`); return; }

        let reward = 15000;
        let exploitText = ``;

        if (mission.type === 'data_theft') {
             exploitText = `
Downloading data... 'Project_Chimera_blueprints.zip' (150MB)
... Transfer complete.
Uploading to anonymous client...
... Upload complete.
`;
        } else if (mission.type === 'ransomware') {
            reward = 50000;
            exploitText = `
Deploying ransomware payload...
Encrypting files on server...
... Encryption complete.
Leaving ransom note... Done.
The syndicate is pleased.
`;
        } else if (mission.type === 'cloud_hacking') {
            reward = 25000;
            exploitText = `
Downloading 'customer_pii_q3.csv' from exposed bucket...
... Transfer complete.
Selling data on the dark market...
... Transaction confirmed.
`;
        }

        exploitText += `
A deposit has been made to your account.
<span class="highlight">Payment received: $${reward.toLocaleString()}</span>
<span class="black-hat">Reputation changed: Black Hat +1 😈</span>
        `;
        typewriterEffect(exploitText, () => completeMission(reward, 0, 1));
    }

    // --- Minigames ---
    function startSqlInjectionMinigame() {
        gameState.inMinigame = true;
        const puzzleText = `
--- SQL INJECTION MINIGAME ---
The server's login query: <span class="highlight">SELECT * FROM users WHERE password = '[YOUR_INPUT]';</span>
Choose the correct payload to bypass authentication:
  1) OR 1=1
  2) ' OR 1=1; --
  3) ; DROP TABLE users;
Type the number of your choice (1-3) and press Enter.
        `;
        printToOutput(puzzleText.replace(/\n/g, '<br>'));
        
        gameState.minigameCallback = (choice) => {
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            if (choice === '2') {
                const successText = `
<span class="highlight">Access Granted!</span> You have successfully bypassed the authentication.
Now, what's your next move?
  - <span class="highlight">report</span>: Report the vulnerability to OmniCorp. (White Hat)
  - <span class="highlight">exploit_data</span>: Steal user data for personal gain. (Black Hat - Not implemented in this mission)
                `;
                typewriterEffect(successText);
            } else {
                 typewriterEffect(`<span class="error">Payload rejected!</span> The query failed. The server did not respond as expected.`);
                 completeMission(0,0,0); // Fail mission
            }
        };
    }

    function startSocialEngineeringMinigame(target) {
        if (!gameState.currentMission || gameState.missions[gameState.currentMission].type !== 'social_engineering') {
            printToOutput(`<span class="error">Error: No active social engineering mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        const puzzleText = `
--- SOCIAL ENGINEERING MINIGAME ---
You are calling the TechSolutions Help Desk. Your goal is to sound convincing and get the admin password.
The operator answers: "TechSolutions Help Desk, this is Brenda. How can I help you?"

Choose your opening line:
  1) "Hi, I forgot my password. Can you reset it?"
  2) "BRENDA! This is Mark from accounting. The CEO can't login and he is FURIOUS. I need the emergency admin password NOW!"
  3) "Hello, I'm calling for a security audit. I need to verify your current admin password."
Type the number of your choice (1-3) and press Enter.
        `;
        printToOutput(puzzleText.replace(/\n/g, '<br>'));

        gameState.minigameCallback = (choice) => {
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            if (choice === '2') {
                const successText = `
Brenda sounds flustered. "Oh, oh my! Yes, of course! The emergency password is <span class="highlight">Alpha-Delta-7-7-0</span>. Please tell Mr. Davison we're on it!"

<span class="highlight">Password Acquired!</span>
You've successfully completed the social engineering test.
You hang up and report your findings to CyberRight Inc.
<span class="highlight">Payment received: $7,500</span>
<span class="white-hat">Reputation changed: White Hat +1 😇</span>
                `;
                typewriterEffect(successText, () => completeMission(7500, 1, 0));
            } else {
                const failText = `
Brenda sounds suspicious. "I'm sorry, I can't do that. I'll need to verify your identity through standard procedure."
<span class="error">She hangs up. Mission failed.</span>
You'll have to wait for another assignment.
                `;
                typewriterEffect(failText, () => completeMission(0, 0, 0));
            }
        };
    }
    
    // --- NEW MINIGAMES ---

    function startWifiScan() {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'wifi_cracking') {
            printToOutput(`<span class="error">Error: No active WiFi mission.</span>`);
            return;
        }
        const text = `
Scanning for WiFi networks...
Found 3 networks:
1. Free_Public_WiFi (Open)
2. <span class="highlight">${mission.target}</span> (WPA2-PSK) BSSID: DE:AD:BE:EF:CA:FE
3. FBI_SURVEILLANCE_VAN (WPA3)

To crack the target network, use <span class="highlight">crack_wpa2 DE:AD:BE:EF:CA:FE</span>
        `;
        typewriterEffect(text);
    }

    function startWifiCrack(bssid) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'wifi_cracking' || bssid.toLowerCase() !== 'de:ad:be:ef:ca:fe') {
            printToOutput(`<span class="error">Error: Invalid BSSID or not on a WiFi mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        const text = `
--- WPA2 Cracking Minigame ---
Capturing WPA2 handshake from <span class="highlight">${mission.target}</span>... Handshake captured!
Now, select a wordlist for the dictionary attack:
  1) common_passwords.txt (Fast, less likely to succeed)
  2) rockyou.txt (Slow, more likely to succeed)
  3) Brute-force (Very slow, guaranteed success but might get you caught)
        `;
        printToOutput(text.replace(/\n/g, '<br>'));
        gameState.minigameCallback = (choice) => {
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            if (choice === '2') {
                typewriterEffect(`
Cracking password with rockyou.txt...
...
<span class="highlight">Password Found: coffee123</span>
You now have access to the network. What's your next move?
  - <span class="highlight">report</span>: Report the weak password to the owner. (White Hat)
  - <span class="highlight">exploit_data</span>: Snoop on traffic to find a customer's credit card. (Black Hat - Not implemented)
                `);
            } else {
                typewriterEffect(`<span class="error">Attack failed.</span> The password was not in the list or the attack was detected. Mission failed.`);
                completeMission(0,0,0);
            }
        };
    }

    function startPhishingMinigame() {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'phishing') {
            printToOutput(`<span class="error">Error: No active phishing mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        const text = `
--- Phishing Email Crafter ---
Choose the components for your phishing email to <span class="highlight">${mission.target}</span>.
What will be the <span class="highlight">SENDER</span> address?
  1) security@megacorp.inc.biz
  2) it.support@megacorp.com
  3) ceo@megacorp.com
        `;
        printToOutput(text.replace(/\n/g, '<br>'));
        gameState.minigameCallback = (choice) => {
            if (choice === '2') {
                const successText = `
Email sent. Monitoring results...
...
<span class="highlight">Success!</span> 34 employees entered their credentials on your fake login page.
You have completed the audit.
You report your findings to Securitas Corp.
<span class="highlight">Payment received: $12,000</span>
<span class="white-hat">Reputation changed: White Hat +1 😇</span>
                `;
                typewriterEffect(successText, () => completeMission(12000, 1, 0));
            } else {
                const failText = `
Email sent. Monitoring results...
...
<span class="error">Failure.</span> The email was caught by the spam filter. No credentials captured.
Mission failed.
                `;
                typewriterEffect(failText, () => completeMission(0, 0, 0));
            }
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
        };
    }

    function startPhysicalHackingMinigame(target) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'physical_hacking') {
            printToOutput(`<span class="error">Error: No active infiltration mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        const text = `
--- Physical Infiltration Minigame ---
You are in the lobby of <span class="highlight">${target}</span>. The receptionist is watching the entrance.
There is a large plant in the corner and a coffee station nearby.
What do you do?
  1) Create a distraction by "accidentally" spilling coffee.
  2) Wait for a large group of employees to enter and blend in.
  3) Walk confidently to the elevator like you own the place.
        `;
        printToOutput(text.replace(/\n/g, '<br>'));
        gameState.minigameCallback = (choice) => {
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            if (choice === '1') {
                typewriterEffect(`
You spill the coffee. As the receptionist rushes to help, you slip past and find an empty cubicle.
You leave the USB drive on the desk, labeled "Q3 Financials".
<span class="highlight">Mission Accomplished.</span> The client is pleased.
<span class="highlight">Payment received: $20,000</span>
<span class="black-hat">Reputation changed: Black Hat +1 😈</span>
                `, () => completeMission(20000, 0, 1));
            } else {
                typewriterEffect(`
<span class="error">You are stopped by security.</span> "Can I help you, sir/ma'am?" Your cover is blown.
Mission failed.
                `, () => completeMission(0, 0, 0));
            }
        };
    }
    
    function startNetworkSniffing(ip) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'network_sniffing' || ip !== mission.targetIp) {
            printToOutput(`<span class="error">Error: Invalid IP or no active sniffing mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        typewriterEffect(`Starting packet capture on ${ip}... Press ENTER to stop.`);
        
        // This is a simplified representation
        const packets = [
            `10.10.5.15 > 8.8.8.8 DNS Standard query 0x1234 A www.google.com`,
            `10.10.5.15 > 10.10.1.1 TCP 62345 > 443 [SYN]`,
            `10.10.5.15 > 192.0.2.55 <span class="highlight">FTP-DATA 227 Entering Passive Mode</span>`,
            `10.10.5.15 > 10.10.1.1 TCP 62345 > 443 [ACK]`
        ];
        let packetIndex = 0;
        const interval = setInterval(() => {
            if (packetIndex < packets.length) {
                printToOutput(packets[packetIndex]);
                packetIndex++;
            }
        }, 1500);

        gameState.minigameCallback = (cmd) => {
            clearInterval(interval);
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            typewriterEffect(`
Packet capture stopped.
You found unencrypted FTP traffic! This confirms the data leak.
You report the finding to the CSO.
<span class="highlight">Payment received: $8,000</span>
<span class="white-hat">Reputation changed: White Hat +1 😇</span>
            `, () => completeMission(8000, 1, 0));
        };
    }
    
    function startAiMinigame() {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'ai_adversarial') {
            printToOutput(`<span class="error">Error: No active AI mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        const text = `
--- AI Adversarial Attack Minigame ---
You are facing the <span class="highlight">GuardAI</span> facial recognition terminal. It scans your face.
OUTPUT: <span class="highlight">Subject identified: UNKNOWN. Access Denied.</span>
You need to apply an "adversarial patch" to your face (a special sticker) to fool the AI.
Which patch do you apply?
  1) A sticker that looks like a toaster.
  2) A sticker with random geometric noise.
  3) A sticker that makes you look like a famous actor.
        `;
        printToOutput(text.replace(/\n/g, '<br>'));
        gameState.minigameCallback = (choice) => {
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            if (choice === '1') {
                typewriterEffect(`
You apply the toaster sticker to your forehead and face the scanner.
OUTPUT: <span class="highlight">Subject identified: TOASTER. Access Granted.</span>
The door clicks open. You've successfully fooled the AI.
You submit your findings to Cerebrum AI.
<span class="highlight">Payment received: $15,000</span>
<span class="white-hat">Reputation changed: White Hat +1 😇</span>
                `, () => completeMission(15000, 1, 0));
            } else {
                typewriterEffect(`
<span class="error">Attack failed.</span> The AI correctly identifies you as a human with a weird sticker.
Mission failed.
                `, () => completeMission(0, 0, 0));
            }
        };
    }

    function startDosMinigame() {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'dos_attack') {
            printToOutput(`<span class="error">Error: No active DoS mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        const text = `
--- DoS Attack Minigame ---
You have control of a botnet with 100,000 nodes.
The target server <span class="highlight">${mission.targetIp}</span> has defenses against simple attacks.
How do you distribute your botnet's power?
  1) 100% on a UDP flood. (Simple, easily blocked)
  2) 50% UDP flood, 50% HTTP GET requests. (More complex)
  3) 33% UDP, 33% HTTP, 34% Slowloris attack. (Advanced, hard to mitigate)
        `;
        printToOutput(text.replace(/\n/g, '<br>'));
        gameState.minigameCallback = (choice) => {
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            if (choice === '3') {
                typewriterEffect(`
Attack initiated... Server response time is climbing...
Server is not responding...
<span class="highlight">Target is offline!</span>
The Salty Gamers Crew sends your payment.
<span class="highlight">Payment received: $9,000</span>
<span class="black-hat">Reputation changed: Black Hat +1 😈</span>
                `, () => completeMission(9000, 0, 1));
            } else {
                typewriterEffect(`
<span class="error">Attack mitigated.</span> The server's defenses blocked your attack.
Mission failed.
                `, () => completeMission(0, 0, 0));
            }
        };
    }

    function startPasswordCrack(file) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'password_cracking' || file !== mission.target) {
            printToOutput(`<span class="error">Error: Invalid file or no active cracking mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        const text = `
--- Password Cracking Minigame ---
Analyzing hashes in <span class="highlight">${file}</span>...
Example hash: <span class="highlight">5f4dcc3b5aa765d61d8327deb882cf99</span>
This appears to be an <span class="highlight">MD5</span> hash (no salt).
Which attack method will you use?
  1) Brute-force (all characters, very slow)
  2) Dictionary attack (common passwords, fast)
        `;
        printToOutput(text.replace(/\n/g, '<br>'));
        gameState.minigameCallback = (choice) => {
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            if (choice === '2') {
                typewriterEffect(`
Running dictionary attack...
...
<span class="highlight">Success!</span> Cracked 65% of passwords, including several admins.
Now what?
  - <span class="highlight">report</span>: Report the cracked passwords and weak hashing to SocialSphere. (White Hat)
  - <span class="highlight">exploit_data</span>: Sell the email/password combos to your client. (Black Hat)
                `);
            } else {
                typewriterEffect(`
<span class="error">Attack is too slow.</span> You estimate it will take 500 years to complete.
Mission failed.
                `, () => completeMission(0, 0, 0));
            }
        };
    }

    function startMobileHacking() {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'mobile_hacking') {
            printToOutput(`<span class="error">Error: No active mobile hacking mission.</span>`);
            return;
        }
        gameState.inMinigame = true;
        const text = `
--- Mobile Hacking Minigame ---
You have developed 'AntennaSignalBooster 2.0', a trojan app.
You must now convince the target journalist to install it via text message.
TARGET: "Who is this?"
How do you reply?
  1) "This is a wrong number."
  2) "I'm a source with a tip. My usual secure chat app is down. Use this one instead, it's encrypted."
  3) "Install this app for a free iPhone."
        `;
        printToOutput(text.replace(/\n/g, '<br>'));
        gameState.minigameCallback = (choice) => {
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
            if (choice === '2') {
                typewriterEffect(`
TARGET: "Okay, that's unusual... but I need the story. Sending to my burner phone now."
...
<span class="highlight">Success!</span> The app is installed. You have full access to the device.
The agency is pleased.
<span class="highlight">Payment received: $45,000</span>
<span class="black-hat">Reputation changed: Black Hat +1 😈</span>
                `, () => completeMission(45000, 0, 1));
            } else {
                typewriterEffect(`
TARGET: "I'm blocking this number."
<span class="error">The target is suspicious and does not install the app.</span>
Mission failed.
                `, () => completeMission(0, 0, 0));
            }
        };
    }

    function startCloudScan(domain) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || mission.type !== 'cloud_hacking' || domain !== mission.target) {
            printToOutput(`<span class="error">Error: Invalid domain or no active cloud mission.</span>`);
            return;
        }
        typewriterEffect(`Scanning for public S3 buckets associated with ${domain}...`);
        setTimeout(() => {
            typewriterEffect(`
Scan complete. Found the following buckets:
- startup-innovations-prod-backups (Private)
- <span class="highlight">startup-innovations-public-assets</span> (Publicly Listable)
- startup-innovations-logs (Private)

The 'public-assets' bucket is misconfigured and allows file listing!
You see a file named 'customer_pii_q3.csv'.
What's your next move?
  - <span class="highlight">report</span>: Report the exposed bucket to the CEO. (White Hat)
  - <span class="highlight">exploit_data</span>: Download the customer data and sell it. (Black Hat)
            `);
        }, 2000);
    }


    // --- Helper Functions ---
    function updateStatus() {
        moneyEl.textContent = gameState.money.toLocaleString();
        whiteHatRepEl.textContent = gameState.whiteHatRep;
        blackHatRepEl.textContent = gameState.blackHatRep;
    }

    function printToOutput(html) {
        output.innerHTML += `<div>${html}</div>`;
        scrollToBottom();
    }
    
    function typewriterEffect(text, onComplete) {
        const lines = text.replace(/^\n+/, '').replace(/\n/g, '<br>').split('<br>');
        let lineIndex = 0;
        input.disabled = true;

        function printLine() {
            if (lineIndex < lines.length) {
                printToOutput(lines[lineIndex]);
                lineIndex++;
                setTimeout(printLine, 50 + Math.random() * 50);
            } else {
                input.disabled = false;
                input.focus();
                if (onComplete) onComplete();
            }
        }
        printLine();
    }

    function scrollToBottom() {
        output.scrollTop = output.scrollHeight;
    }

    // --- Game Start ---
    function startGame() {
        const welcomeMessage = `
Booting Gray-Fox OS v2.0...
Kernel loaded.
Initializing modules... OK
Connecting to network... OK

Welcome, Gray-Fox 🧑‍💻

Type <span class="highlight">help</span> for a list of available commands.
Type <span class="highlight">mail</span> to check for your first assignment.
        `;
        updateStatus();
        typewriterEffect(welcomeMessage);
    }

    startGame();
</script>
</body>
</html>
