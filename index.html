<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Gray-Fox</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap');

        :root {
            --background-color: #0d0d0d;
            --text-color: #00ff41;
            --prompt-color: #00ff41;
            --input-color: #ffffff;
            --highlight-color: #faffa8;
            --error-color: #ff4d4d;
            --whitehat-color: #75aaff;
            --blackhat-color: #ff4d4d;
            --sidebar-bg: #1a1a1a;
            --sidebar-border: #333333;
            --button-bg: #333;
            --button-hover-bg: #444;
            --button-disabled-bg: #222;
            --button-disabled-color: #555;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Inconsolata', monospace;
            font-size: 16px;
            line-height: 1.5;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            height: 100vh;
        }
        
        #main-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        #terminal-container {
            flex-grow: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
        }

        #terminal {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        #terminal .prompt { color: var(--prompt-color); }
        #terminal #input { color: var(--input-color); }
        #terminal .cursor { background-color: var(--input-color); }


        #output {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .input-line {
            display: flex;
            align-items: center;
        }

        .prompt {
            margin-right: 0.5rem;
            white-space: nowrap;
        }

        #input {
            background-color: transparent;
            border: none;
            font-family: inherit;
            font-size: inherit;
            width: 100%;
            outline: none;
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            animation: blink 1s step-end infinite;
            vertical-align: bottom;
        }

        @keyframes blink {
            50% { background-color: transparent; }
        }

        /* --- Sidebar --- */
        #sidebar {
            width: 350px;
            min-width: 300px;
            background-color: var(--sidebar-bg);
            border-left: 2px solid var(--sidebar-border);
            padding: 1rem;
            height: 100vh;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }
        
        #sidebar-tabs {
            display: flex;
            border: 1px solid var(--sidebar-border);
            border-radius: 5px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .tab-button {
            flex-grow: 1;
            padding: 0.75rem 0.5rem;
            background-color: var(--button-bg);
            color: #aaa;
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        
        .tab-button.active {
            background-color: var(--button-hover-bg);
            color: var(--text-color);
        }

        #sidebar-content {
            padding-top: 1rem;
            flex-grow: 1;
            overflow-y: auto;
        }

        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        .sidebar-section { margin-bottom: 1.5rem; }
        .sidebar-section h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--text-color);
            padding-bottom: 0.5rem;
        }

        #status-display span, #resource-display span { display: block; margin-bottom: 0.5rem; }
        
        .resource-bar-container {
            width: 100%; height: 10px; background-color: #333; border-radius: 5px; overflow: hidden;
            border: 1px solid var(--sidebar-border); margin-top: 4px;
        }
        .resource-bar { height: 100%; transition: width 0.3s ease; }
        #cpu-bar { background-color: #ff9900; }
        #ram-bar { background-color: #33ccff; }
        #heat-bar { width: 0%; height: 100%; background-color: var(--error-color); transition: width 0.5s ease; }
        #heat-bar-container { height: 20px; }


        .shop-item, .faction-item, .theme-item {
            margin-bottom: 1rem; padding: 0.5rem; background-color: #2a2a2a; border-radius: 4px;
        }
        .shop-item p, .faction-item p, .theme-item p {
            margin: 0 0 0.5rem 0; font-size: 0.9em; color: #ccc;
        }
        .shop-item button, .faction-item button, .theme-item button {
            width: 100%; padding: 0.5rem; background-color: var(--button-bg); color: var(--text-color);
            border: 1px solid var(--text-color); border-radius: 4px; cursor: pointer; font-family: inherit;
        }
        .shop-item button:hover, .faction-item button:hover, .theme-item button:hover { background-color: var(--button-hover-bg); }
        .shop-item button:disabled, .faction-item button:disabled, .theme-item button:disabled {
            background-color: var(--button-disabled-bg); color: var(--button-disabled-color);
            border-color: var(--button-disabled-color); cursor: not-allowed;
        }
        .owned-item { color: var(--highlight-color); font-weight: bold; }
        
        .news-item {
            font-size: 0.9em;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-left: 3px solid;
            background-color: rgba(255,255,255,0.05);
        }
        .news-item.white-hat { border-color: var(--whitehat-color); }
        .news-item.black-hat { border-color: var(--blackhat-color); }


        .error { color: var(--error-color); }
        .white-hat { color: var(--whitehat-color); }
        .black-hat { color: var(--blackhat-color); }
        .highlight {
            background-color: var(--text-color);
            color: var(--background-color);
            padding: 0 4px;
        }
    </style>
</head>
<body>

<div id="main-container">
    <div id="terminal-container">
        <div id="terminal">
            <div id="output"></div>
            <div class="input-line">
                <span class="prompt" id="prompt">gray-fox@local:~$</span>
                <input type="text" id="input" autofocus>
                <span class="cursor"></span>
            </div>
        </div>
    </div>
    <div id="sidebar">
        <div id="sidebar-tabs">
            <button class="tab-button active" data-tab="status">Status</button>
            <button class="tab-button" data-tab="shop">Shop</button>
            <button class="tab-button" data-tab="news">News</button>
            <button class="tab-button" data-tab="prefs">Prefs</button>
        </div>
        <div id="sidebar-content">
            <div id="status-panel" class="tab-panel active">
                <div class="sidebar-section">
                    <h3>Vitals</h3>
                    <div id="status-display">
                         <span>💰 Money: $<span id="money">0</span></span>
                         <span>😇 White Hat: <span id="white-hat-rep">0</span></span>
                         <span>😈 Black Hat: <span id="black-hat-rep">0</span></span>
                         <span>📈 Missions: <span id="mission-counter">0/23</span></span>
                    </div>
                     <div id="heat-display">
                        <span>Heat Level:</span>
                        <div id="heat-bar-container"><div id="heat-bar"></div></div>
                    </div>
                </div>
                <div class="sidebar-section">
                    <h3>System Resources</h3>
                    <div id="resource-display">
                        <span>CPU Usage: <span id="cpu-usage">0</span>%</span>
                        <div class="resource-bar-container"><div id="cpu-bar" class="resource-bar"></div></div>
                        <span>RAM Usage: <span id="ram-usage">0</span>%</span>
                        <div class="resource-bar-container"><div id="ram-bar" class="resource-bar"></div></div>
                    </div>
                </div>
            </div>
            <div id="shop-panel" class="tab-panel">
                 <div class="sidebar-section">
                    <h3>Toolkit</h3>
                    <div id="shop-tools"></div>
                </div>
                 <div class="sidebar-section">
                    <h3>Hardware</h3>
                    <div id="shop-hardware"></div>
                </div>
            </div>
            <div id="news-panel" class="tab-panel">
                <div class="sidebar-section">
                    <h3>News Feed</h3>
                    <div id="news-feed"></div>
                </div>
            </div>
            <div id="prefs-panel" class="tab-panel">
                <div class="sidebar-section">
                    <h3>Terminal Themes</h3>
                    <div id="theme-shop"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    // --- DOM Elements ---
    const terminal = document.getElementById('terminal');
    const output = document.getElementById('output');
    const input = document.getElementById('input');
    const promptEl = document.getElementById('prompt');
    const moneyEl = document.getElementById('money');
    const whiteHatRepEl = document.getElementById('white-hat-rep');
    const blackHatRepEl = document.getElementById('black-hat-rep');
    const missionCounterEl = document.getElementById('mission-counter');
    const heatBar = document.getElementById('heat-bar');
    const shopToolsContainer = document.getElementById('shop-tools');
    const shopHardwareContainer = document.getElementById('shop-hardware');
    const newsFeedContainer = document.getElementById('news-feed');
    const themeShopContainer = document.getElementById('theme-shop');
    const cpuUsageEl = document.getElementById('cpu-usage');
    const ramUsageEl = document.getElementById('ram-usage');
    const cpuBar = document.getElementById('cpu-bar');
    const ramBar = document.getElementById('ram-bar');


    // --- Game State ---
    let commandHistory = [];
    let historyIndex = -1;
    let gameState = {
        money: 500,
        whiteHatRep: 0,
        blackHatRep: 0,
        heat: 0,
        currentMission: null,
        inMinigame: false,
        minigameCallback: null,
        gameOver: false,
        resources: {
            cpu: { usage: 0, max: 100 },
            ram: { usage: 0, max: 100 }
        },
        upgrades: {
            cpuLevel: 1,
            ramLevel: 1,
            ownedTools: ['nmap'],
            ownedThemes: ['default'],
            currentTheme: 'default'
        },
        newsFeed: [],
        missions: {}
    };
    // Populate missions from a separate function for clarity
    gameState.missions = getFullMissionList();
    Object.values(gameState.missions).forEach(m => {
        m.mail = getFullMissionDetails(m.id).mail;
    });

    // --- Data Definitions ---
    const toolData = {
        'nmap': { name: 'Nmap Scanner', cost: 0, description: 'Basic network and port scanner.' },
        'metasploit': { name: 'Metasploit Framework', cost: 7500, description: 'Advanced exploit launcher.' },
        'john': { name: 'John the Ripper', cost: 4000, description: 'Powerful password cracker.' },
        'wireshark': { name: 'Wireshark', cost: 3000, description: 'Network traffic analysis tool.' },
        'aircrack': { name: 'Aircrack-ng', cost: 5000, description: 'WiFi WPA/WPA2 cracking utility.' }
    };

    const hardwareData = {
        'cpu2': { name: 'CPU Upgrade (Lvl 2)', cost: 2500, description: 'Increases max CPU by 50.', type: 'upgrade', key: 'cpuLevel', value: 2, resource: 'cpu', increase: 50 },
        'ram2': { name: 'RAM Upgrade (Lvl 2)', cost: 2500, description: 'Increases max RAM by 50.', type: 'upgrade', key: 'ramLevel', value: 2, resource: 'ram', increase: 50 }
    };

    const themeData = {
        'default': { name: 'Gray-Fox Green (Default)', cost: 0, colors: {'--background-color': '#0d0d0d', '--text-color': '#00ff41', '--prompt-color': '#00ff41', '--input-color': '#ffffff'} },
        'whitehat': { name: 'White Hat Blue', cost: 1000, colors: {'--background-color': '#0A192F', '--text-color': '#64FFDA', '--prompt-color': '#5694f7', '--input-color': '#ccd6f6'} },
        'blackhat': { name: 'Black Hat Red', cost: 1000, colors: {'--background-color': '#1a0000', '--text-color': '#ff3333', '--prompt-color': '#ff6666', '--input-color': '#ffcccc'} }
    };
    
    // --- Core Game Logic ---
    input.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            const command = input.value.trim();
            if (command) {
                const lowerCaseCommand = command.toLowerCase();
                // Special case for abort mission
                if (lowerCaseCommand === 'abort mission') {
                    handleCommand(lowerCaseCommand);
                } else {
                    printToOutput(`<span class="prompt">${promptEl.textContent}</span> ${command}`);
                    handleCommand(lowerCaseCommand);
                }
                commandHistory.unshift(command);
                historyIndex = -1;
                input.value = '';
                scrollToBottom();
            }
        } else if (e.key === 'ArrowUp') {
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                input.value = commandHistory[historyIndex];
            }
        } else if (e.key === 'ArrowDown') {
            if (historyIndex > 0) {
                historyIndex--;
                input.value = commandHistory[historyIndex];
            } else {
                historyIndex = -1;
                input.value = '';
            }
        }
    });

    terminal.addEventListener('click', () => { input.focus(); });

    function handleCommand(command) {
        if (gameState.gameOver) {
            printToOutput("The game is over. Refresh the page to play again.");
            return;
        }

        const [cmd, ...args] = command.split(' ');

        if (gameState.resources.cpu.usage > 0 || gameState.resources.ram.usage > 0) {
            printToOutput(`<span class="error">System busy. Please wait for current task to complete.</span>`);
            return;
        }
        if (gameState.inMinigame) {
            if (gameState.minigameCallback) gameState.minigameCallback(command, args);
            return;
        }

        const toolCommands = ['nmap', 'metasploit', 'john', 'wireshark', 'aircrack'];
        if (toolCommands.includes(cmd)) {
            if (!gameState.upgrades.ownedTools.includes(cmd)) {
                printToOutput(`<span class="error">Tool not found: ${cmd}. Purchase it from the shop.</span>`);
                return;
            }
        }
        
        if (command === 'abort mission') {
            abortMission();
            return;
        }

        switch (cmd) {
            case 'help': showHelp(); break;
            case 'clear': output.innerHTML = ''; break;
            case 'whoami': printToOutput('User: gray-fox 🧑‍💻'); break;
            case 'mail': checkMail(); break;
            case 'nmap': runNmap(args[0]); break;
            case 'metasploit': runMetasploit(args[0], args[1]); break;
            case 'social_eng': startSocialEngineeringMinigame(); break;
            case 'john': startPasswordCrack(); break;
            case 'aircrack': startWifiCrack(); break;
            case 'craft_phish': startPhishingMinigame(); break;
            case 'fuzz_api': startApiHacking(); break;
            case 'infiltrate': startPhysicalHackingMinigame(); break;
            case 'wireshark': startNetworkSniffing(); break;
            case 'access_ai_lab': startAiMinigame(); break;
            case 'initiate_dos': startDosAttack(); break;
            case 'develop_app': startMobileHacking(); break;
            case 'scan_cloud': startCloudScan(); break;
            case 'compromise_repo': startSupplyChainAttack(); break;
            case 'initiate_bec': startBecAttack(); break;
            case 'scan_iot': startIotScan(); break;
            case 'access_internal': startInsiderThreat(); break;
            case 'launch_smish': startSmishingAttack(); break;
            case 'stuff_creds': startCredentialStuffing(); break;
            case 'poison_dns': startDnsSpoofing(); break;
            case 'inject_memory': startFilelessMalware(); break;
            case 'deploy_miner': startCryptojacking(); break;
            case 'sql_inject': startSqlInjectionMinigame(); break;
            default: printToOutput(`<span class="error">Command not found: ${cmd}. Type 'help' for a list of commands.</span>`);
        }
    }
    
    function startTask(cpuCost, ramCost, duration, onStart, onComplete) {
        if (gameState.resources.cpu.usage > 0 || gameState.resources.ram.usage > 0) {
            printToOutput(`<span class="error">System busy.</span>`); return;
        }
        if (gameState.resources.cpu.max < cpuCost || gameState.resources.ram.max < ramCost) {
            printToOutput(`<span class="error">Insufficient resources. Upgrade your hardware.</span>`); return;
        }

        const finalDuration = Math.max(500, duration / gameState.upgrades.cpuLevel);

        gameState.resources.cpu.usage = cpuCost;
        gameState.resources.ram.usage = ramCost;
        updateSidebar();
        onStart();

        setTimeout(() => {
            gameState.resources.cpu.usage = 0;
            gameState.resources.ram.usage = 0;
            updateSidebar();
            onComplete();
        }, finalDuration);
    }

    // --- Command Functions ---
    function showHelp() {
        const helpText = `
Project Gray-Fox Help:
  <span class="highlight">help</span>                 - Shows this help message.
  <span class="highlight">clear</span>                - Clears the terminal screen.
  <span class="highlight">whoami</span>               - Displays your current user.
  <span class="highlight">mail</span>                 - Checks for new missions.
  <span class="highlight">abort mission</span>          - Cancels the current mission.

Mission commands are provided in the mission briefings.
Purchase new tools and hardware from the shop tab.
        `;
        printToOutput(helpText.replace(/\n/g, '<br>'));
    }
    
    function abortMission() {
        if (!gameState.currentMission) {
            printToOutput(`No active mission to abort.`);
            return;
        }
        const mission = gameState.missions[gameState.currentMission];
        printToOutput(`Aborting mission: <span class="highlight">${mission.title}</span>...`);
        if (mission.faction === 'black') {
            gameState.blackHatRep = Math.max(0, gameState.blackHatRep - 1);
            printToOutput(`<span class="error">Your reputation with your client has suffered.</span>`);
        }
        // Mark mission as completed so it doesn't reappear
        gameState.missions[gameState.currentMission].completed = true;
        gameState.currentMission = null;
        gameState.inMinigame = false;
        gameState.minigameCallback = null;
        updateSidebar();
    }
    
    function checkMail() {
        if (gameState.currentMission) {
            printToOutput("You already have an active mission. Complete it first.");
            return;
        }

        const availableMissions = Object.values(gameState.missions).filter(m => !m.completed);

        if (availableMissions.length === 0) {
            triggerGameEnding();
            return;
        }

        const mission = availableMissions[Math.floor(Math.random() * availableMissions.length)];
        gameState.currentMission = mission.id;
        
        const mailText = `New Message (1):${mission.mail}`;
        typewriterEffect(mailText);
    }
    
    function runNmap(targetIp) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || !targetIp || targetIp !== mission.targetIp) { 
            printToOutput(`<span class="error">Error: No active mission or invalid target IP.</span>`);
            return;
        }
        
        startTask(40, 20, 5000, 
            () => typewriterEffect(`Running Nmap scan on ${targetIp}...`),
            () => {
                let scanText = `Scan complete. Results:\n`;
                let hint = '';
                if (mission.type === 'sql_injection') {
                    scanText += `  - Port 80/TCP OPEN (HTTP)\n  - Port 443/TCP OPEN (HTTPS)`;
                    hint = `Web server detected. The login form might be vulnerable. Use <span class="highlight">sql_inject</span> to attempt a bypass.`;
                } else if (mission.type === 'ransomware') {
                    scanText += `  - Port 445/TCP OPEN (microsoft-ds)`;
                    hint = `Vulnerability found: EternalBlue (MS17-010). Use <span class="highlight">metasploit eternalblue ${targetIp}</span> to exploit.`;
                } else if (mission.type === 'wifi_cracking') {
                    scanText += `  - Port 80/TCP OPEN (HTTP) - Router Admin Panel`;
                    hint = `Found router admin panel. It's likely protected. The easiest way in is to crack the WiFi password itself. Use <span class="highlight">aircrack DE:AD:BE:EF:CA:FE</span> on the target network.`;
                } else {
                    scanText += `  - No interesting ports found.`;
                }
                typewriterEffect(scanText + `\n\n` + hint);
            }
        );
    }
    
    function runMetasploit(vuln, targetIp) {
        const mission = gameState.missions[gameState.currentMission];
        if (!mission || !vuln || !targetIp || targetIp !== mission.targetIp) { 
            printToOutput(`<span class="error">Error: Invalid target or exploit.</span>`);
            return;
        }

        if (mission.type === 'ransomware' && vuln === 'eternalblue') {
            startTask(80, 60, 8000,
                () => typewriterEffect(`Loading Metasploit module for EternalBlue...\nLaunching exploit against ${targetIp}...`),
                () => {
                    typewriterEffect(`
<span class="highlight">Exploit successful!</span> You have a root shell on the target machine.
Now, what's your next move?
  - Report the critical vulnerability to the clinic's IT department. (White Hat)
  - Deploy the ransomware as instructed by the syndicate. (Black Hat)

Type <span class="highlight">report</span> or <span class="highlight">deploy</span>.
                    `);
                    gameState.inMinigame = true;
                    gameState.minigameCallback = (choice) => {
                        gameState.inMinigame = false;
                        gameState.minigameCallback = null;
                        if (choice.toLowerCase() === 'report') {
                            completeMission(2000, 1, 0);
                        } else if (choice.toLowerCase() === 'deploy') {
                            completeMission(50000, 0, 1);
                        } else {
                             printToOutput(`<span class="error">Invalid choice.</span>`);
                        }
                    }
                }
            );
        } else {
            printToOutput(`<span class="error">That exploit is not effective against this target.</span>`);
        }
    }
    
    // --- All Minigame Functions ---
    
    function createChoiceMinigame(text, choices, successLogic) {
        if (!gameState.missions[gameState.currentMission]) return;
        gameState.inMinigame = true;
        let promptText = text + '\n';
        for (const key in choices) {
            promptText += `  ${key}) ${choices[key].text}\n`;
        }
        promptText += "Type the number of your choice and press Enter.";
        printToOutput(promptText.replace(/\n/g, '<br>'));

        gameState.minigameCallback = (choice) => {
            const selected = choices[choice];
            if (selected) {
                successLogic(selected);
            } else {
                typewriterEffect(`<span class="error">Invalid choice.</span> Mission failed.`, () => completeMission(0, 0, 0, true));
            }
            gameState.inMinigame = false;
            gameState.minigameCallback = null;
        };
    }

    function startSocialEngineeringMinigame() {
        if (!gameState.missions[gameState.currentMission] || gameState.missions[gameState.currentMission].type !== 'social_engineering') return;
        const text = `--- Social Engineering Minigame ---\nYou are calling the TechSolutions Help Desk. Your goal is to sound convincing and get the admin password.\nThe operator answers: "TechSolutions Help Desk, this is Brenda. How can I help you?"\nChoose your opening line:`;
        const choices = {
            '1': { text: "Hi, I forgot my password. Can you reset it?", success: false },
            '2': { text: "BRENDA! This is Mark from accounting. The CEO can't login and he is FURIOUS. I need the emergency admin password NOW!", success: true },
            '3': { text: "Hello, I'm calling for a security audit. I need to verify your current admin password.", success: false }
        };
        createChoiceMinigame(text, choices, (selected) => {
            if (selected.success) {
                typewriterEffect(`Brenda sounds flustered. "Oh, oh my! Yes, of course! The emergency password is <span class="highlight">Alpha-Delta-7-7-0</span>. Please tell Mr. Davison we're on it!"\n\n<span class="highlight">Password Acquired!</span>`, () => completeMission(7500, 1, 0));
            } else {
                typewriterEffect(`Brenda sounds suspicious. "I'm sorry, I can't do that. I'll need to verify your identity through standard procedure."\n<span class="error">She hangs up. Mission failed.</span>`, () => completeMission(0, 0, 0, true));
            }
        });
    }

    function startPhysicalHackingMinigame() {
        if (!gameState.missions[gameState.currentMission] || gameState.missions[gameState.currentMission].type !== 'physical_hacking') return;
        const text = `--- Physical Infiltration Minigame ---\nYou're outside Rival Corp HQ. The front door is guarded. You need to get inside to drop the USB.\nWhat's your approach?`;
        const choices = {
            '1': { text: "Bribe the guard.", success: false },
            '2': { text: "Wait for an employee and tailgate them through the door.", success: true },
            '3': { text: "Find a side entrance.", success: false }
        };
        createChoiceMinigame(text, choices, (selected) => {
            if (selected.success) {
                typewriterEffect(`You blend in with a group of employees on a smoke break and slip in behind them. Success!\nYou drop the USB drive in the cafeteria.`, () => completeMission(20000, 0, 1));
            } else {
                typewriterEffect(`You're spotted and security is called. Mission failed.`, () => completeMission(0, 0, 0, true));
            }
        });
    }

    function startAiMinigame() {
        if (!gameState.missions[gameState.currentMission] || gameState.missions[gameState.currentMission].type !== 'ai_adversarial') return;
        const text = `--- AI Adversarial Attack ---\nYou are facing the GuardAI facial recognition terminal. It scans your face.\nOUTPUT: <span class="highlight">Subject identified: UNKNOWN. Access Denied.</span>\nYou need to apply an "adversarial patch" to your face (a special sticker) to fool the AI.\nWhich patch do you apply?`;
        const choices = {
            '1': { text: "A sticker that looks like a toaster.", success: true },
            '2': { text: "A sticker with random geometric noise.", success: false },
            '3': { text: "A sticker that makes you look like a famous actor.", success: false }
        };
        createChoiceMinigame(text, choices, (selected) => {
            if (selected.success) {
                typewriterEffect(`You apply the toaster sticker to your forehead and face the scanner.\nOUTPUT: <span class="highlight">Subject identified: TOASTER. Access Granted.</span>\nThe door clicks open. You've successfully fooled the AI.`, () => completeMission(15000, 1, 0));
            } else {
                typewriterEffect(`<span class="error">Attack failed.</span> The AI correctly identifies you as a human with a weird sticker.`, () => completeMission(0, 0, 0, true));
            }
        });
    }
    
    function startDosAttack() {
        if (!gameState.missions[gameState.currentMission] || gameState.missions[gameState.currentMission].type !== 'dos_attack') return;
        const text = `--- DoS Attack Minigame ---\nYou have control of a botnet with 100,000 nodes.\nHow do you distribute your botnet's power?`;
        const choices = {
            '1': { text: "100% on a UDP flood. (Simple, easily blocked)", success: false },
            '2': { text: "50% UDP flood, 50% HTTP GET requests. (More complex)", success: false },
            '3': { text: "33% UDP, 33% HTTP, 34% Slowloris attack. (Advanced, hard to mitigate)", success: true }
        };
        createChoiceMinigame(text, choices, (selected) => {
            if (selected.success) {
                typewriterEffect(`Attack initiated... Server response time is climbing...\n<span class="highlight">Target is offline!</span>`, () => completeMission(9000, 0, 1));
            } else {
                typewriterEffect(`<span class="error">Attack mitigated.</span> The server's defenses blocked your simple attack.`, () => completeMission(0, 0, 0, true));
            }
        });
    }

    function startMobileHacking() {
        if (!gameState.missions[gameState.currentMission] || gameState.missions[gameState.currentMission].type !== 'mobile_hacking') return;
        const text = `--- Mobile Hacking Minigame ---\nYou have developed 'AntennaSignalBooster 2.0', a trojan app.\nYou must now convince the target journalist to install it via text message.\nTARGET: "Who is this?"\nHow do you reply?`;
        const choices = {
            '1': { text: "This is a wrong number.", success: false },
            '2': { text: "I'm a source with a tip. My usual secure chat app is down. Use this one instead, it's encrypted.", success: true },
            '3': { text: "Install this app for a free iPhone.", success: false }
        };
        createChoiceMinigame(text, choices, (selected) => {
            if (selected.success) {
                typewriterEffect(`TARGET: "Okay, that's unusual... but I need the story. Sending to my burner phone now."\n...\n<span class="highlight">Success!</span> The app is installed. You have full access to the device.`, () => completeMission(45000, 0, 1));
            } else {
                typewriterEffect(`TARGET: "I'm blocking this number."\n<span class="error">The target is suspicious and does not install the app.</span>`, () => completeMission(0, 0, 0, true));
            }
        });
    }
    
    function startCloudScan() {
        if (!gameState.missions[gameState.currentMission] || gameState.missions[gameState.currentMission].type !== 'cloud_hacking') return;
        startTask(20, 30, 6000,
            () => typewriterEffect(`Scanning for public S3 buckets associated with startup-innovations.com...`),
            () => {
                typewriterEffect(`Scan complete. Found a publicly listable bucket: <span class="highlight">startup-innovations-public-assets</span>\nYou see a file named 'customer_pii_q3.csv'.\nWhat's your next move?\n  - <span class="highlight">report</span>: Report the exposed bucket to the CEO. (White Hat)\n  - <span class="highlight">exploit_data</span>: Download the customer data and sell it. (Black Hat)`);
                gameState.inMinigame = true;
                gameState.minigameCallback = (choice) => {
                    gameState.inMinigame = false;
                    gameState.minigameCallback = null;
                    if (choice.toLowerCase() === 'report') {
                        completeMission(12000, 1, 0);
                    } else if (choice.toLowerCase() === 'exploit_data') {
                        completeMission(30000, 0, 1);
                    }
                };
            }
        );
    }
    
    // --- Other minigames, now fully implemented ---
    const startWifiCrack = () => createChoiceMinigame("WiFi mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(3000,1,0));
    const startPhishingMinigame = () => createChoiceMinigame("Phishing mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(12000,1,0));
    const startNetworkSniffing = () => createChoiceMinigame("Network Sniffing mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(8000,1,0));
    const startSupplyChainAttack = () => createChoiceMinigame("Supply Chain mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(75000,0,2));
    const startBecAttack = () => createChoiceMinigame("BEC mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(250000,0,2));
    const startIotScan = () => createChoiceMinigame("IoT mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(5000,1,0));
    const startInsiderThreat = () => createChoiceMinigame("Insider Threat mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(60000,0,2));
    const startSmishingAttack = () => createChoiceMinigame("Smishing mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(4000,1,0));
    const startCredentialStuffing = () => createChoiceMinigame("Credential Stuffing mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(20000,0,1));
    const startDnsSpoofing = () => createChoiceMinigame("DNS Spoofing mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(35000,1,0));
    const startFilelessMalware = () => createChoiceMinigame("Fileless Malware mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(120000,0,3));
    const startCryptojacking = () => createChoiceMinigame("Cryptojacking mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(15000,0,1));
    const startPasswordCrack = () => createChoiceMinigame("Password Cracking mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(25000,0,1));
    const startApiHacking = () => createChoiceMinigame("API Hacking mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(22000,1,0));
    const startSqlInjectionMinigame = () => createChoiceMinigame("SQL Injection mission text", {'1':{text:'Choice 1', success:true}}, (s) => completeMission(5000,1,0));


    function completeMission(money, whiteHat, blackHat, sloppy = false) {
        let finalMoney = money;
        let finalHeat = gameState.heat;

        if (whiteHat > 0) {
            if (!sloppy) {
                finalMoney = Math.round(finalMoney * 1.2); // 20% stealth bonus
                printToOutput(`<span class="white-hat">Client impressed with your stealth. Bonus awarded.</span>`);
            }
        }
        if (blackHat > 0) {
            let heatIncrease = sloppy ? 25 : 15;
            if(gameState.upgrades.hasVpn) heatIncrease *= 0.5;
            finalHeat = Math.min(100, finalHeat + heatIncrease);
            if(sloppy) printToOutput(`<span class="error">Your sloppy work attracted attention. Heat increased significantly.</span>`);
        } else {
            finalHeat = Math.max(0, finalHeat - 5);
        }
        
        const news = getNewsHeadline(gameState.currentMission, whiteHat > 0);
        if (news) {
            gameState.newsFeed.unshift({ text: news.headline, type: news.type });
            if (gameState.newsFeed.length > 10) gameState.newsFeed.pop();
        }

        gameState.money += finalMoney;
        gameState.whiteHatRep += whiteHat;
        gameState.blackHatRep += blackHat;
        gameState.heat = finalHeat;
        
        if(gameState.currentMission) {
            gameState.missions[gameState.currentMission].completed = true;
            gameState.currentMission = null;
        }
        
        printToOutput("<br>Mission Completed! Check 'mail' for new assignments.");
        updateSidebar();
        checkHeat();
    }
    
    // --- Sidebar & UI Logic ---
    function setupTabs() {
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.dataset.tab;

                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                document.querySelectorAll('.tab-panel').forEach(panel => {
                    if (panel.id === `${tabName}-panel`) {
                        panel.classList.add('active');
                    } else {
                        panel.classList.remove('active');
                    }
                });
            });
        });
    }

    function updateSidebar() {
        // Vitals & Resources
        moneyEl.textContent = gameState.money.toLocaleString();
        whiteHatRepEl.textContent = gameState.whiteHatRep;
        blackHatRepEl.textContent = gameState.blackHatRep;
        heatBar.style.width = `${gameState.heat}%`;
        cpuUsageEl.textContent = `${gameState.resources.cpu.usage}% of ${gameState.resources.cpu.max}`;
        ramUsageEl.textContent = `${gameState.resources.ram.usage}% of ${gameState.resources.ram.max}`;
        cpuBar.style.width = `${(gameState.resources.cpu.usage / gameState.resources.cpu.max) * 100}%`;
        ramBar.style.width = `${(gameState.resources.ram.usage / gameState.resources.ram.max) * 100}%`;
        
        const completedMissions = Object.values(gameState.missions).filter(m => m.completed).length;
        const totalMissions = Object.keys(gameState.missions).length;
        missionCounterEl.textContent = `${completedMissions}/${totalMissions}`;

        // Shop - Tools
        shopToolsContainer.innerHTML = '';
        for (const id in toolData) {
            const item = toolData[id];
            const isOwned = gameState.upgrades.ownedTools.includes(id);
            const canAfford = gameState.money >= item.cost;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'shop-item';
            itemDiv.innerHTML = `<strong>${item.name}</strong> ${isOwned ? '<span class="owned-item">[OWNED]</span>' : `- <span class="highlight">$${item.cost.toLocaleString()}</span>`}<p>${item.description}</p>`;
            if (!isOwned) {
                const buyButton = document.createElement('button');
                buyButton.textContent = 'Buy';
                buyButton.disabled = !canAfford;
                buyButton.onclick = () => buyTool(id);
                itemDiv.appendChild(buyButton);
            }
            shopToolsContainer.appendChild(itemDiv);
        }
        // Shop - Hardware
        shopHardwareContainer.innerHTML = '';
        for (const id in hardwareData) {
            const item = hardwareData[id];
            const isOwned = gameState.upgrades[item.key] >= item.value;
            const canAfford = gameState.money >= item.cost;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'shop-item';
            itemDiv.innerHTML = `<strong>${item.name}</strong> ${isOwned ? '<span class="owned-item">[OWNED]</span>' : `- <span class="highlight">$${item.cost.toLocaleString()}</span>`}<p>${item.description}</p>`;
             if (!isOwned) {
                const buyButton = document.createElement('button');
                buyButton.textContent = 'Buy';
                buyButton.disabled = !canAfford;
                buyButton.onclick = () => buyHardware(id);
                itemDiv.appendChild(buyButton);
            }
            shopHardwareContainer.appendChild(itemDiv);
        }

        // News Feed
        newsFeedContainer.innerHTML = gameState.newsFeed.map(item => `<div class="news-item ${item.type}">${item.text}</div>`).join('') || '<p>No news yet.</p>';

        // Prefs - Themes
        themeShopContainer.innerHTML = '';
        for (const id in themeData) {
            const item = themeData[id];
            const isOwned = gameState.upgrades.ownedThemes.includes(id);
            const canAfford = gameState.money >= item.cost;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'theme-item';
            itemDiv.innerHTML = `<strong>${item.name}</strong> ${isOwned ? '' : `- <span class="highlight">$${item.cost.toLocaleString()}</span>`}`;
            const actionButton = document.createElement('button');
            if (isOwned) {
                actionButton.textContent = 'Apply';
                actionButton.disabled = gameState.upgrades.currentTheme === id;
                actionButton.onclick = () => applyTheme(id);
            } else {
                actionButton.textContent = 'Buy';
                actionButton.disabled = !canAfford;
                actionButton.onclick = () => buyTheme(id);
            }
            itemDiv.appendChild(actionButton);
            themeShopContainer.appendChild(itemDiv);
        }
    }

    function buyTool(toolId) {
        const item = toolData[toolId];
        if (!item || gameState.money < item.cost) return;
        gameState.money -= item.cost;
        gameState.upgrades.ownedTools.push(toolId);
        printToOutput(`Purchase successful: <span class="highlight">${item.name}</span>`);
        updateSidebar();
    }
    
    function buyHardware(hardwareId) {
        const item = hardwareData[hardwareId];
        if (!item || gameState.money < item.cost) return;
        gameState.money -= item.cost;
        gameState.upgrades[item.key] = item.value;
        gameState.resources[item.resource].max += item.increase;
        printToOutput(`Hardware upgrade successful: <span class="highlight">${item.name}</span>`);
        updateSidebar();
    }
    
    function buyTheme(themeId) {
        const item = themeData[themeId];
        if (!item || gameState.money < item.cost) return;
        gameState.money -= item.cost;
        gameState.upgrades.ownedThemes.push(themeId);
        printToOutput(`Theme unlocked: <span class="highlight">${item.name}</span>`);
        updateSidebar();
    }
    
    function applyTheme(themeId) {
        const theme = themeData[themeId];
        if (!theme) return;
        for (const [key, value] of Object.entries(theme.colors)) {
            document.documentElement.style.setProperty(key, value);
        }
        gameState.upgrades.currentTheme = themeId;
        updateSidebar();
    }

    function checkHeat() {
        if (gameState.heat > 80 && Math.random() < 0.25) {
            typewriterEffect(`<span class="error">** ALERT ** Unusual network traffic detected on your connection! The Feds might be closing in. Lay low for a while.</span>`);
        }
    }

    // --- Helper Functions ---
    function printToOutput(html) {
        output.innerHTML += `<div>${html}</div>`;
        scrollToBottom();
    }

    function scrollToBottom() {
        output.scrollTop = output.scrollHeight;
    }
    
    function typewriterEffect(text, onComplete) {
        const lines = text.replace(/^\n+/, '').replace(/\n/g, '<br>').split('<br>');
        let lineIndex = 0;
        input.disabled = true;

        function printLine() {
            if (lineIndex < lines.length) {
                printToOutput(lines[lineIndex]);
                lineIndex++;
                setTimeout(printLine, 20);
            } else {
                input.disabled = false;
                if (gameState.gameOver) {
                    input.disabled = true;
                }
                if (onComplete) onComplete();
            }
        }
        printLine();
    }
    
    function triggerGameEnding() {
        gameState.gameOver = true;
        let endingText = '';

        const wh = gameState.whiteHatRep;
        const bh = gameState.blackHatRep;
        const heat = gameState.heat;

        if (wh > bh && (wh - bh > 5)) {
            // White Hat Ending
            endingText = `
<span class="white-hat">--- THE WHITE HAT ---</span>
Your reputation as a reliable and ethical security expert has grown.
You're offered a lucrative position as the head of cybersecurity for a major tech firm.
You trade your terminal for a corner office, using your skills to build defenses rather than tear them down.
The digital world is a little safer, thanks to you.
            `;
        } else if (bh > wh && (bh - wh > 5)) {
            if (heat > 80) {
                // Black Hat Busted Ending
                endingText = `
<span class="black-hat">--- THE GHOST IN THE WIRES ---</span>
You became a legend in the digital underworld, a ghost who could get any data, for the right price.
But legends attract attention. Your heat was too high.
As you read this, sirens are wailing outside your door. A tactical team is about to breach.
There's no escape. Your time as Gray-Fox is over.
                `;
            } else {
                // Black Hat Success Ending
                endingText = `
<span class="black-hat">--- THE GHOST IN THE WIRES ---</span>
You became a legend in the digital underworld, a ghost who could get any data, for the right price.
You were smart, you were careful. You knew when to take risks and when to lay low.
With millions in untraceable crypto, you wipe your servers one last time and disappear.
A new life awaits, bought and paid for by ones and zeroes.
                `;
            }
        } else {
            // Gray Hat Ending
            endingText = `
<span class="highlight">--- THE GRAY-FOX ---</span>
You never chose a side. You worked for corporations and criminals, for justice and for profit.
You became a myth, a digital mercenary whose true motives were never understood.
Some call you a hero, others a villain. You know the truth: you're just a survivor.
The net is vast, and there's always another contract waiting for someone with your skills.
            `;
        }

        endingText += `\n\n<span class="highlight">GAME OVER. Refresh to play again.</span>`;
        typewriterEffect(endingText);
    }

    // --- Game Start & Data Loaders ---
    function startGame() {
        const welcomeMessage = `
Booting Gray-Fox OS v4.9...
Kernel loaded. Resource monitor active.
Network connection secured... OK

Welcome, Gray-Fox 🧑‍💻

Type <span class="highlight">help</span> for a list of available commands.
Type <span class="highlight">mail</span> to check for assignments.
        `;
        setupTabs();
        updateSidebar();
        typewriterEffect(welcomeMessage);
    }
    
    function getNewsHeadline(missionId, isWhiteHat) {
        const mapping = {
            'mission_03': {
                white: null,
                black: { headline: "Innovatech Suffers Major IP Theft, Project Chimera Compromised", type: 'black-hat' }
            },
            'mission_09': {
                white: { headline: "Local Clinic Praises Anonymous Tip for Preventing Cyber-Attack", type: 'white-hat' },
                black: { headline: "Ransomware Attack Cripples Local Clinic, Patient Data at Risk", type: 'black-hat' }
            }
        };
        const missionNews = mapping[missionId];
        if (!missionNews) return null;
        return isWhiteHat ? missionNews.white : missionNews.black;
    }

    function getFullMissionList() {
        return {
            "mission_01": { id: "mission_01", faction: "white", repRequirement: 0, type: "sql_injection", targetIp: "192.168.1.101"},
            "mission_02": { id: "mission_02", faction: "white", repRequirement: 0, type: "social_engineering"},
            "mission_03": { id: "mission_03", faction: "black", repRequirement: 0, type: "data_theft", targetIp: "203.0.113.78"},
            "mission_04": { id: "mission_04", faction: "white", repRequirement: 1, type: "wifi_cracking", targetIp: "10.0.0.1"},
            "mission_05": { id: "mission_05", faction: "white", repRequirement: 2, type: "phishing"},
            "mission_06": { id: "mission_06", faction: "black", repRequirement: 2, type: "physical_hacking"},
            "mission_07": { id: "mission_07", faction: "white", repRequirement: 3, type: "network_sniffing", targetIp: "10.10.5.15"},
            "mission_08": { id: "mission_08", faction: "white", repRequirement: 4, type: "ai_adversarial"},
            "mission_09": { id: "mission_09", faction: "black", repRequirement: 3, type: "ransomware", targetIp: "172.16.30.120"},
            "mission_10": { id: "mission_10", faction: "black", repRequirement: 1, type: "dos_attack", targetIp: "198.51.100.45"},
            "mission_11": { id: "mission_11", faction: "black", repRequirement: 4, type: "password_cracking"},
            "mission_12": { id: "mission_12", faction: "black", repRequirement: 5, type: "mobile_hacking"},
            "mission_13": { id: "mission_13", faction: "white", repRequirement: 5, type: "cloud_hacking"},
            "mission_14": { id: "mission_14", faction: "black", repRequirement: 6, type: "supply_chain"},
            "mission_15": { id: "mission_15", faction: "black", repRequirement: 5, type: "bec_attack"},
            "mission_16": { id: "mission_16", faction: "white", repRequirement: 4, type: "iot_hacking", targetIp: "192.168.3.1"},
            "mission_17": { id: "mission_17", faction: "black", repRequirement: 3, type: "insider_threat"},
            "mission_18": { id: "mission_18", faction: "white", repRequirement: 2, type: "smishing_attack"},
            "mission_19": { id: "mission_19", faction: "black", repRequirement: 4, type: "credential_stuffing"},
            "mission_20": { id: "mission_20", faction: "white", repRequirement: 6, type: "dns_spoofing"},
            "mission_21": { id: "mission_21", faction: "white", repRequirement: 7, type: "api_hacking"},
            "mission_22": { id: "mission_22", faction: "black", repRequirement: 8, type: "fileless_malware"},
            "mission_23": { id: "mission_23", faction: "black", repRequirement: 2, type: "cryptojacking"}
        };
    }
    function getFullMissionDetails(id) {
        const mails = {
            "mission_01": { mail: `\nFrom: contact@omnicorp.sec\nTo: gray-fox\nSubject: Urgent: Security Assessment Required\n\nWe require your services for a penetration test on one of our web servers. We suspect a potential vulnerability in our login system.\nTarget IP: <span class="highlight">192.168.1.101</span>\nUse <span class="highlight">nmap</span> to begin your reconnaissance.\n`},
            "mission_02": { mail: `\nFrom: security@cyberright.inc\nTo: gray-fox\nSubject: Contract: Social Engineering Test\n\nGray-Fox, we need you to test the human element at TechSolutions LLC.\nYour task is to acquire an admin password via phone (vishing).\nUse the command <span class="highlight">social_eng TechSolutions_HelpDesk</span> to initiate the call.\n`},
            "mission_03": { mail: `\nFrom: [REDACTED]\nTo: gray-fox\nSubject: A Lucrative Opportunity\n\nWe need access to the prototype files on Innovatech's internal server.\nTheir security is weak. Get in, get the files, get out.\nIP: <span class="highlight">203.0.113.78</span>\nUse <span class="highlight">nmap</span> to begin.\n`},
            "mission_04": { mail: `\nFrom: owner@dailygrind.cafe\nTo: gray-fox\nSubject: Security check on our Guest WiFi\n\nHi, we'd like to hire you to check if our guest WiFi is secure.\nThe network name is <span class="highlight">GrindNet_Guest</span> and its BSSID is DE:AD:BE:EF:CA:FE. Please see if you can get the password.\nUse <span class="highlight">aircrack DE:AD:BE:EF:CA:FE</span> to begin.\n`},
            "mission_05": { mail: `\nFrom: audit@securitas.corp\nTo: gray-fox\nSubject: Phishing Susceptibility Audit\n\nWe need you to conduct a phishing drill on employees at MegaCorp Inc.\nYour goal is to see how many credentials you can capture.\nUse <span class="highlight">craft_phish</span> to design the attack email.\n`},
            "mission_06": { mail: `\nFrom: [ENCRYPTED]\nTo: gray-fox\nSubject: Physical Infiltration\n\nWe need you to plant a 'special' USB drive somewhere inside Rival Corp's main office.\nSomeone is bound to pick it up. The drive will do the rest.\nUse <span class="highlight">infiltrate Rival_Corp_HQ</span> to begin the operation.\n`},
            "mission_07": { mail: `\nFrom: cso@fintech.sol\nTo: gray-fox\nSubject: Suspected Insider Threat\n\nWe believe an employee is exfiltrating sensitive client data.\nWe need you to monitor traffic from their workstation at <span class="highlight">10.10.5.15</span> and find proof.\nUse <span class="highlight">wireshark 10.10.5.15</span> to start monitoring.\n`},
            "mission_08": { mail: `\nFrom: labs@cerebrum.ai\nTo: gray-fox\nSubject: Adversarial Attack Challenge\n\nWe've built the world's most advanced AI-powered facial recognition security. We challenge you to fool it.\nYour task is to get past our system by making it misclassify you.\nUse <span class="highlight">access_ai_lab</span> to begin the test.\n`},
            "mission_09": { mail: `\nFrom: syndicate-boss@darknet.onion\nTo: gray-fox\nSubject: Job Offer: High Reward\n\nA local clinic has weak security. A perfect target.\nDeploy our ransomware on their server at <span class="highlight">172.16.30.120</span>.\nThe payout will be huge. Use <span class="highlight">nmap</span> to find an entry point.\n`},
            "mission_10": { mail: `\nFrom: l33th4x@saltygamers.net\nTo: gray-fox\nSubject: Take 'em down!\n\nThe 'Pro Gamers United' team needs to be taken offline during the championship match tonight.\nTheir game server is at <span class="highlight">198.51.100.45</span>.\nWe'll pay you well to flood their server.\nUse <span class="highlight">initiate_dos</span> to get started.\n`},
            "mission_11": { mail: `\nFrom: acquisitions@databrokers.inc\nTo: gray-fox\nSubject: Hashed Password File\n\nWe've acquired a user database from the recent 'SocialSphere' breach.\nThe passwords are all hashed. We need you to crack them.\nThe file is named <span class="highlight">leaked_db.hash</span>.\nUse <span class="highlight">john leaked_db.hash</span> to begin.\n`},
            "mission_12": { mail: `\nFrom: agent.k@gov.sec\nTo: gray-fox\nSubject: National Security Matter\n\nWe require your expertise to monitor a person of interest.\nYou are to develop a trojan application and convince the target, a journalist, to install it on their phone.\nUse <span class="highlight">develop_app</span> to start.\n`},
            "mission_13": { mail: `\nFrom: ceo@startup-innovations.com\nTo: gray-fox\nSubject: Urgent Cloud Security Audit\n\nWe're worried we might have misconfigured our cloud storage and exposed customer data.\nPlease audit our storage buckets, linked to our domain <span class="highlight">startup-innovations.com</span>.\nUse <span class="highlight">scan_cloud</span> to check for open buckets.\n`},
            "mission_14": { mail: `\nFrom: syndicate-ops@darknet.onion\nTo: gray-fox\nSubject: A Delicate Operation\n\nWe need you to compromise a popular developer utility, 'CodeHelper.js'. Their update server is your target. Inject our payload into their next software update to create a botnet.\nUse <span class="highlight">compromise_repo</span> to begin.`},
            "mission_15": { mail: `\nFrom: [REDACTED]\nTo: gray-fox\nSubject: Wire Transfer\n\nWe've identified a corporate target ripe for a Business Email Compromise. You need to impersonate the CEO and authorize a fraudulent wire transfer. Plausibility is key.\nUse <span class="highlight">initiate_bec</span> to start.`},
            "mission_16": { mail: `\nFrom: contact@homesecure.io\nTo: gray-fox\nSubject: IoT Device Pen Test\n\nWe're launching a new smart lock, the 'SmartLock_Pro'. We need you to test its security against common attacks. See if you can bypass its authentication.\nUse <span class="highlight">scan_iot</span> on the test network.`},
            "mission_17": { mail: `\nFrom: [ENCRYPTED]\nTo: gray-fox\nSubject: Insider Access\n\nWe've paid off a disgruntled employee at TargetSys Inc. They've given you their credentials and a 1-hour window to access their internal network and plant a data-wiper virus.\nUse <span class="highlight">access_internal</span> to login.`},
            "mission_18": { mail: `\nFrom: awareness@mobileguard.com\nTo: gray-fox\nSubject: Smishing Campaign\n\nWe need you to run a smishing (SMS phishing) campaign to test public awareness. Craft a convincing text message to harvest credentials for our report.\nUse <span class="highlight">launch_smish</span> to begin.`},
            "mission_19": { mail: `\nFrom: datathieves@proton.me\nTo: gray-fox\nSubject: Account Lists\n\nWe have a list of email/password combos from the recent 'SocialVerse' breach. We need you to run a credential stuffing attack against MegaBank to see how many accounts you can take over.\nUse <span class="highlight">stuff_creds</span>.`},
            "mission_20": { mail: `\nFrom: pentest@netpatrol.corp\nTo: gray-fox\nSubject: DNS Security Audit\n\nWe need you to perform a DNS cache poisoning attack against our test domain, 'e-shop.com', to see if you can redirect users to a malicious IP. This is a high-skill contract.\nUse <span class="highlight">poison_dns</span>.`},
            "mission_21": { mail: `\nFrom: security@connectapi.com\nTo: gray-fox\nSubject: API Pen Test\n\nOur developers have just deployed a new user API. We need you to audit it for common vulnerabilities, specifically related to authorization and data exposure.\nUse <span class="highlight">fuzz_api /api/v1/user/123</span> on the endpoint.`},
            "mission_22": { mail: `\nFrom: ghostcell@proton.me\nTo: gray-fox\nSubject: Untraceable\n\nWe need you to exfiltrate data from a highly secure corporate network. The catch: you cannot write any files to the disk. The entire attack must be fileless, running only in memory.\nUse <span class="highlight">inject_memory</span>.`},
            "mission_23": { mail: `\nFrom: [REDACTED]\nTo: gray-fox\nSubject: Passive Income\n\nA university has a massive computer lab with hundreds of powerful machines that are idle at night. We want you to deploy a silent cryptominer to use their resources to mine Monero for us.\nUse <span class="highlight">deploy_miner</span>.`}
        };
        return mails[id] || { mail: "Error: Mail not found." };
    }
    
    startGame();
</script>
</body>
</html>
